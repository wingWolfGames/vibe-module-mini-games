(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3946:function(e,t,i){Promise.resolve().then(i.bind(i,5857))},5857:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return G}});var s=i(7437),o=i(2265);class n{reset(){this.playerLives=10,this.playerAmmo=6,this.score=0,this.gameOver=!1,this.gameStarted=!1,this.showDoubleTapToShoot=!0,this.currentScreen="TITLE",this.currentLevel=1,this.scoreThresholdForNextLevel=50,this.badGuys=[],this.goodGuys=[],this.unknownGuys=[],this.lifeUps=[],this.hitCircles=[],this.isPlayerHit=!1,this.isHitByBadGuy=!1,this.badGuyShotEffects=[],this.showReloadOk=!1,this.isReloadShaking=!1,this.clearTimeouts()}loseLife(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.playerLives--,this.isPlayerHit=!0,this.isHitByBadGuy=e,this.playerHitTimeoutId&&clearTimeout(this.playerHitTimeoutId),this.playerHitTimeoutId=setTimeout(()=>{this.isPlayerHit=!1,this.isHitByBadGuy=!1,this.playerHitTimeoutId=null},200),this.playerLives<=0&&(this.gameOver=!0,this.clearTimeouts())}shootBullet(){return this.playerAmmo>0&&(this.playerAmmo--,this.showDoubleTapToShoot&&(this.showDoubleTapToShoot=!1),!0)}reloadAmmo(){return this.playerAmmo<6&&(this.playerAmmo=6,this.showReloadOk=!0,this.isReloadShaking=!0,this.reloadOkTimeoutId&&clearTimeout(this.reloadOkTimeoutId),this.reloadOkTimeoutId=setTimeout(()=>{this.showReloadOk=!1,this.isReloadShaking=!1,this.reloadOkTimeoutId=null},500),!0)}addScore(e){this.score+=e,this.score>=this.scoreThresholdForNextLevel&&(this.currentLevel++,this.currentLevel>4&&(this.currentLevel=1),this.scoreThresholdForNextLevel+=50)}addBadGuy(e){this.badGuys.push(e)}removeBadGuy(e){this.badGuys=this.badGuys.filter(t=>t!==e)}addGoodGuy(e){this.goodGuys.push(e)}removeGoodGuy(e){this.goodGuys=this.goodGuys.filter(t=>t!==e)}addUnknownGuy(e){this.unknownGuys.push(e)}removeUnknownGuy(e){this.unknownGuys=this.unknownGuys.filter(t=>t!==e)}addLife(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.playerLives+=e}addLifeUp(e){this.lifeUps.push(e)}removeLifeUp(e){this.lifeUps=this.lifeUps.filter(t=>t!==e)}createHitCircle(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:25;this.hitCircles.push({x:e,y:t,radius:i,creationTime:Date.now()})}processHitCircles(){if(this.gameOver)return;let e=Date.now();this.hitCircles=this.hitCircles.filter(t=>e-t.creationTime<100),this.hitCircles.forEach(e=>{this.badGuys.forEach(t=>{t.isAlive&&t.isHit(e.x,e.y,e.radius)&&(console.log("HitCircle at (".concat(e.x,", ").concat(e.y,") hit BadGuy at (").concat(t.x,", ").concat(t.y,")")),t.takeDamage(1),t.isAlive||this.addScore(10))}),this.goodGuys.forEach(t=>{t.isAlive&&t.isHit(e.x,e.y,e.radius)&&(console.log("HitCircle at (".concat(e.x,", ").concat(e.y,") hit GoodGuy at (").concat(t.x,", ").concat(t.y,")")),t.takeDamage(1),t.isAlive||this.loseLife())}),this.unknownGuys.forEach(t=>{t.isAlive&&t.isHit(e.x,e.y,e.radius)&&(console.log("HitCircle at (".concat(e.x,", ").concat(e.y,") hit UnknownGuy at (").concat(t.x,", ").concat(t.y,")")),t.takeDamage(1),t.isAlive||this.loseLife())}),this.lifeUps.forEach(t=>{t.isAlive&&t.isHit(e.x,e.y,e.radius)&&(console.log("HitCircle at (".concat(e.x,", ").concat(e.y,") hit LifeUp at (").concat(t.x,", ").concat(t.y,")")),this.addLife(1),t.isAlive=!1)})}),this.badGuys=this.badGuys.filter(e=>e.isAlive),this.goodGuys=this.goodGuys.filter(e=>e.isAlive),this.unknownGuys=this.unknownGuys.filter(e=>e.isAlive),this.lifeUps=this.lifeUps.filter(e=>e.isAlive)}createBadGuyShotEffect(e,t){console.log("Creating BadGuyShotEffect at (".concat(e,", ").concat(t,") at ").concat(performance.now())),this.badGuyShotEffects.push({x:e,y:t,creationTime:performance.now(),duration:500,damageApplied:!1})}processBadGuyShotEffects(){console.log("Processing BadGuyShotEffects at ".concat(performance.now(),". Number of effects: ").concat(this.badGuyShotEffects.length));let e=performance.now();this.badGuyShotEffects=this.badGuyShotEffects.filter(t=>(e-t.creationTime>=t.duration&&!t.damageApplied&&(console.log("Applying damage from BadGuyShotEffect at (".concat(t.x,", ").concat(t.y,"). Player lives before: ").concat(this.playerLives)),this.loseLife(!0),t.damageApplied=!0,console.log("Player lives after: ".concat(this.playerLives))),e-t.creationTime<t.duration))}clearTimeouts(){this.playerHitTimeoutId&&(clearTimeout(this.playerHitTimeoutId),this.playerHitTimeoutId=null),this.reloadOkTimeoutId&&(clearTimeout(this.reloadOkTimeoutId),this.reloadOkTimeoutId=null)}setScreen(e){this.currentScreen=e}getBackgroundIndexForLevel(){return(this.currentLevel-1)%4}constructor(){this.playerLives=10,this.playerAmmo=6,this.score=0,this.gameOver=!1,this.gameStarted=!1,this.showDoubleTapToShoot=!0,this.currentScreen="TITLE",this.hasGameBeenPlayedOnce=!1,this.currentLevel=1,this.scoreThresholdForNextLevel=50,this.badGuys=[],this.goodGuys=[],this.unknownGuys=[],this.lifeUps=[],this.hitCircles=[],this.isPlayerHit=!1,this.badGuyShotEffects=[],this.showReloadOk=!1,this.isReloadShaking=!1,this.isHitByBadGuy=!1,this.playerHitTimeoutId=null,this.reloadOkTimeoutId=null}}let r=new n;class a{initEventListeners(){this.boundHandleMouseDown=this.handleMouseDown.bind(this),this.boundHandleMouseUp=this.handleMouseUp.bind(this),this.boundHandleMouseMove=this.handleMouseMove.bind(this),this.boundHandleTouchStart=this.handleTouchStart.bind(this),this.boundHandleTouchEnd=this.handleTouchEnd.bind(this),this.boundHandleTouchMove=this.handleTouchMove.bind(this),this.canvas.addEventListener("mousedown",this.boundHandleMouseDown),this.canvas.addEventListener("mouseup",this.boundHandleMouseUp),this.canvas.addEventListener("mousemove",this.boundHandleMouseMove),this.canvas.addEventListener("touchstart",this.boundHandleTouchStart),this.canvas.addEventListener("touchend",this.boundHandleTouchEnd),this.canvas.addEventListener("touchmove",this.boundHandleTouchMove),this.onShoot=null,this.onReload=null}handleMouseDown(e){"PLAYING"!==r.currentScreen||r.gameOver||(this.isMouseDown=!0,this.mouseDownTime=Date.now(),this.swipeStartY=e.clientY)}handleMouseUp(e){if("PLAYING"===r.currentScreen&&!r.gameOver&&(this.isMouseDown=!1,Date.now()-this.mouseDownTime<200&&this.onShoot&&this.canShoot)){let t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,s=e.clientY-t.top;this.onShoot(i,s),this.canShoot=!1,setTimeout(()=>{this.canShoot=!0},this.shootCooldown)}}handleMouseMove(e){this.isMouseDown&&this.onReload&&this.swipeStartY-e.clientY>this.reloadThreshold&&(r.reloadAmmo()&&this.onReload(),this.isMouseDown=!1)}handleTouchStart(e){"PLAYING"!==r.currentScreen||r.gameOver||1!==e.touches.length||(this.isMouseDown=!0,this.mouseDownTime=Date.now(),this.swipeStartY=e.touches[0].clientY)}handleTouchEnd(e){if("PLAYING"===r.currentScreen&&!r.gameOver&&(this.isMouseDown=!1,Date.now()-this.mouseDownTime<200&&this.onShoot&&this.canShoot)){let t=e.changedTouches[0],i=this.canvas.getBoundingClientRect(),s=t.clientX-i.left,o=t.clientY-i.top;this.onShoot(s,o),this.canShoot=!1,setTimeout(()=>{this.canShoot=!0},this.shootCooldown)}}handleTouchMove(e){this.isMouseDown&&1===e.touches.length&&this.onReload&&this.swipeStartY-e.touches[0].clientY>this.reloadThreshold&&(r.reloadAmmo()&&this.onReload(),this.isMouseDown=!1)}constructor(e){this.canvas=e,this.isMouseDown=!1,this.mouseDownTime=0,this.swipeStartY=0,this.reloadThreshold=50,this.canShoot=!0,this.shootCooldown=200,this.initEventListeners()}}class h{loseLife(){this.lives--,this.lives}shoot(){return r.playerAmmo>0}reload(){this.reloading=!1}constructor(){this.lives=5,this.reloading=!1}}class l{update(e){return this.canStop&&(!this.isStopped&&.005>Math.random()&&(this.isStopped=!0,this.stopTime=Date.now(),this.resumeTime=this.stopTime+this.stopDuration),this.isStopped&&Date.now()>=this.resumeTime&&(this.isStopped=!1,this.stopTime=0,this.resumeTime=0,this.stopDuration=1e3*Math.random()+1e3,.4>Math.random()&&(this.direction*=-1))),this.isStopped||(this.x+=this.speed*this.direction),1===this.direction&&this.x>this.canvasWidth?(this.isAlive=!1,this.hasCrossedScreen=!0):-1===this.direction&&this.x+this.width<0&&(this.isAlive=!1,this.hasCrossedScreen=!0),!1}isHit(e,t,i){let s=e,o=t;e<this.x?s=this.x:e>this.x+this.width&&(s=this.x+this.width),t<this.y?o=this.y:t>this.y+this.height&&(o=this.y+this.height);let n=e-s,r=t-o;return Math.sqrt(n*n+r*r)<=i}takeDamage(e){this.hp-=e,this.hp<=0&&(this.isAlive=!1,"bad"===this.type&&this.stopFlashing())}constructor(e,t,i,s,o,n,r=1){this.x=e,this.y=t,this.width=i,this.height=s,this.type=o,this.isAlive=!0,this.hp=1,this.direction=r,this.speed=1.5*Math.random()+1,this.isStopped=!1,this.stopTime=0,this.hasCrossedScreen=!1,this.resumeTime=0,this.stopDuration=1e3*Math.random()+1e3,this.canStop=.3>Math.random(),this.canvasWidth=n}}class c extends l{startFlashing(){this.flashInterval||(this.flashing=!0,this.flashCount=0,this.flashInterval=setInterval(()=>{this.flashCount++,this.flashCount>this.maxFlashes&&this.stopFlashing()},this.flashDuration))}stopFlashing(){this.flashing=!1,this.flashInterval&&(clearInterval(this.flashInterval),this.flashInterval=null)}update(e){return this.canStop&&(!this.isStopped&&.005>Math.random()&&(this.isStopped=!0,this.stopTime=Date.now(),this.resumeTime=this.stopTime+this.stopDuration),this.isStopped&&Date.now()>=this.resumeTime&&(this.isStopped=!1,this.stopTime=0,this.resumeTime=0,this.stopDuration=1e3*Math.random()+1e3)),this.isStopped||(this.x+=this.speed*this.direction),1===this.direction&&this.x>this.canvasWidth?this.isAlive=!1:-1===this.direction&&this.x+this.width<0&&(this.isAlive=!1),this.x+this.width>0&&this.x<this.canvasWidth&&!this.hasShotOnScreen&&(this.nextShotTime=Date.now()+1e3*Math.random()+2e3,this.timeToFlash=this.nextShotTime-this.tellDuration,this.hasShotOnScreen=!0),!this.flashing&&this.isAlive&&Date.now()>=this.timeToFlash&&this.startFlashing(),!!(this.isAlive&&Date.now()>=this.nextShotTime)&&(this.stopFlashing(),this.lastShotTime=Date.now(),this.reloadTime=2e3*Math.random()+1e3,this.nextShotTime=Date.now()+this.reloadTime,this.timeToFlash=this.nextShotTime-this.tellDuration,this.startFlashing(),console.log("BadGuy at (".concat(this.x,", ").concat(this.y,") shot at ").concat(Date.now())),{shot:!0,x:this.x+this.width/2,y:this.y+this.height/2})}constructor(e,t,i,s,o,n,r){super(e,t,i,s,"bad",o,n),this.lastShotTime=0,this.reloadTime=2e3*Math.random()+1e3,this.nextShotTime=Date.now()+3e3*Math.random()+2e3,this.flashing=!1,this.flashInterval=null,this.flashCount=0,this.maxFlashes=6,this.flashDuration=100,this.tellDuration=750,this.timeToFlash=this.nextShotTime-this.tellDuration,this.canvasWidth=o,this.hasShotOnScreen=!1,this.image=new Image,this.image.src=r,this.image.onerror=e=>{console.error("Failed to load BadGuy image ".concat(r,":"),e)},this.lowerBodyImage=new Image,this.lowerBodyImage.src="sprite/bad.png",this.lowerBodyImage.onerror=e=>{console.error("Failed to load BadGuy lower body image sprite/bad.png:",e)},this.frameWidth=16,this.frameHeight=16,this.animationFrames=[{x:0,y:0},{x:16,y:0},{x:0,y:16},{x:16,y:16}],this.currentFrameIndex=0,this.lastFrameTime=0,this.frameRate=150}}class d extends l{update(e){return super.update(e),!1}constructor(e,t,i,s,o,n,r){super(e,t,i,s,"good",o,n),this.image=new Image,this.image.src=r,this.image.onerror=e=>{console.error("Failed to load GoodGuy image ".concat(r,":"),e)},this.lowerBodyImage=new Image,this.lowerBodyImage.src="sprite/good.png",this.lowerBodyImage.onerror=e=>{console.error("Failed to load GoodGuy lower body image sprite/good.png:",e)},this.frameWidth=16,this.frameHeight=16,this.animationFrames=[{x:0,y:0},{x:16,y:0},{x:0,y:16},{x:16,y:16}],this.currentFrameIndex=0,this.lastFrameTime=0,this.frameRate=100}}class u extends l{update(e){let t=super.update(e);return!this.transformed&&this.isStopped&&Date.now()>=this.transformTime?(this.transformed=!0,{transform:!0,x:this.x,y:this.y,width:this.width,height:this.height,direction:this.direction}):t||!1}constructor(e,t,i,s,o,n){super(e,t,i,s,"unknown",o,n),this.transformTime=0,this.transformed=!1,this.canStop=!0,this.stopDuration=1e3,this.lowerBodyImage=new Image,this.lowerBodyImage.src="sprite/unknown.png",this.lowerBodyImage.onerror=e=>{console.error("Failed to load UnknownGuy lower body image sprite/unknown.png:",e)},this.frameWidth=16,this.frameHeight=16,this.animationFrames=[{x:0,y:0},{x:16,y:0},{x:0,y:16},{x:16,y:16}],this.currentFrameIndex=0,this.lastFrameTime=0,this.frameRate=100}}class m extends l{update(e){return Date.now()-this.creationTime>this.lifespan&&(this.isAlive=!1),!1}constructor(e,t,i,s){super(e,t,i,s,"powerup"),this.creationTime=Date.now(),this.lifespan=3e3}}var p=i(6648);function g(e){let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/".concat("vibe-module-mini-games")).concat(t)}let f=()=>{let e=["PUBLIC EYE","The Arcade Game","- Mobile Version -"],[t,i]=(0,o.useState)([]),[n,r]=(0,o.useState)(0);return(0,o.useEffect)(()=>{let t=setInterval(()=>{n<e.length?(i(t=>[...t,e[n]]),r(e=>e+1)):setTimeout(()=>{i([]),r(0)},5e3)},500);return()=>clearInterval(t)},[n,e]),(0,s.jsx)("div",{style:{position:"absolute",top:"50%",transform:"translateY(-50%)",textAlign:"center",width:"100%",marginBottom:"20px"},children:t.map((e,t)=>(0,s.jsx)("h1",{style:{fontSize:0===t?"3em":"1.5em",margin:"10px 0",color:"white"},children:e},t))})};var y=e=>{let{onStartIntro:t}=e;return(0,s.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:"url(".concat(g("/backgrounds/HUB2_BG_v02.gif"),")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"white",zIndex:200},children:[(0,s.jsx)(f,{}),(0,s.jsx)("button",{onClick:t,style:{position:"absolute",bottom:"100px",padding:"15px 30px",fontSize:"1.5em",cursor:"pointer",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px"},children:"Start Game"})]})},w=e=>{let{onNext:t}=e,i=["Shoot Suspects!","Protect Victims & Witnesses!!","Defeat the Mastermind!!!"],[n,r]=(0,o.useState)(""),[a,h]=(0,o.useState)(0),[l,c]=(0,o.useState)(0),[d,u]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(a<i.length){if(l<i[a].length){let e=setTimeout(()=>{r(e=>e+i[a][l]),c(e=>e+1)},1500/i[a].length);return()=>clearTimeout(e)}{let e=setTimeout(()=>{r(e=>e+"\n\n"),h(e=>e+1),c(0)},500);return()=>clearTimeout(e)}}u(!0)},[a,l,i]),(0,s.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:"url(".concat(g("/backgrounds/HUB5_BG_v04.gif"),")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",color:"white",zIndex:200,whiteSpace:"pre-wrap"},children:[(0,s.jsxs)("h1",{style:{fontSize:"1.5em",marginBottom:"20px",textAlign:"left",paddingLeft:"10%"},children:[" ",n]}),d&&(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",width:"100%"},children:[" ",(0,s.jsx)("button",{onClick:t,style:{padding:"15px 30px",fontSize:"1.5em",cursor:"pointer",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"5px"},children:"NEXT"})]})]})},v=e=>{let{lives:t,ammo:i,score:o,gameOver:n,showReloadOk:r,isFlashingReload:a,showDoubleTapToShoot:h,onRestart:l,onReturnToTitle:c,currentScreen:d,onStartIntro:u,onStartGame:m,currentLevel:f}=e;return(0,s.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"TITLE"===d||"INTRO"===d||n?"auto":"none"},children:[(0,s.jsx)("div",{style:{position:"absolute",top:"10px",left:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"5px 10px",borderRadius:"5px",zIndex:100},children:(0,s.jsx)("div",{style:{display:"flex",gap:"5px"},children:Array.from({length:t}).map((e,t)=>(0,s.jsx)(p.default,{src:g("/heart/heart.png"),alt:"Life",width:16,height:16,style:{width:"16px",height:"16px"}},t))})}),(0,s.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"5px 10px",borderRadius:"5px",zIndex:100},children:[(0,s.jsxs)("p",{style:{margin:"0",fontSize:"1em"},children:["Score: ",o]}),(0,s.jsxs)("p",{style:{margin:"0",fontSize:"1em"},children:["Level: ",f]})]}),(0,s.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(255, 255, 255, 0.7)",padding:"5px 10px",borderRadius:"5px",zIndex:100,textAlign:"center"},children:(0,s.jsxs)("p",{style:{margin:"0",fontSize:"1em"},children:["Ammo: ",i]})}),a&&0===i&&(0,s.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:101,fontSize:"3em",color:"red",animation:"flash 1s infinite",WebkitAnimation:"flash 1s infinite"},children:["RELOAD",(0,s.jsx)("br",{}),(0,s.jsx)("span",{style:{fontSize:"0.5em"},children:"(swipe up!)"})]}),r&&(0,s.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:101,fontSize:"3em",color:"blue"},children:["RELOAD",(0,s.jsx)("br",{}),"OK"]}),(0,s.jsx)("style",{children:"\n                @keyframes flash {\n                    0% { opacity: 1; }\n                    50% { opacity: 0; }\n                    100% { opacity: 1; }\n                }\n            "}),h&&(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:101,fontSize:"3em",color:"red",animation:"flash 1s infinite",WebkitAnimation:"flash 1s infinite"},children:"Double tap to Shoot!"}),"TITLE"===d&&(0,s.jsx)(y,{onStartIntro:u}),"INTRO"===d&&(0,s.jsx)(w,{onNext:m}),n&&(0,s.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",zIndex:101,backgroundColor:"rgba(0, 0, 0, 0.7)",padding:"20px",borderRadius:"10px",color:"white"},children:[(0,s.jsx)("p",{style:{margin:"0 0 15px 0",fontSize:"2em",fontWeight:"bold"},children:"GAME OVER"}),(0,s.jsx)("button",{onClick:l,style:{padding:"10px 20px",fontSize:"1.2em",cursor:"pointer",pointerEvents:"auto",marginBottom:"10px"},children:"Restart Game"}),(0,s.jsx)("button",{onClick:c,style:{padding:"10px 20px",fontSize:"1.2em",cursor:"pointer",pointerEvents:"auto"},children:"Return to Title Screen"})]})]})};let x=["/npc/Trevor.png","/npc/Wong.png","/npc/Lin.png","/npc/Jonathan.png","/npc/Zephyr.png","/npc/Leonard.png"],S=["/npc/Sophia.png","/npc/Emily.png","/npc/James.png","/npc/Charles.png","/npc/Ethan.png","/npc/Kevin.png","/npc/Sam.png","/npc/arlo.png","/npc/anya.png","/npc/anna.png"];var T=()=>{let e=(0,o.useRef)(null),t=(0,o.useRef)(null),i=(0,o.useRef)(new h),n=(0,o.useRef)(null),l=(0,o.useRef)(null),p=(0,o.useRef)(null),g=(0,o.useRef)(null),[f,y]=(0,o.useState)(null),[w,T]=(0,o.useState)(null),[b,I]=(0,o.useState)(1),[G,k]=(0,o.useState)(0),E=["/backgrounds/subway_bg2.png","/backgrounds/wong_bg.png","/backgrounds/cabby_bg.png","/backgrounds/car_bg.png"],M=(0,o.useRef)(null),A=(0,o.useRef)(null),[L,D]=(0,o.useState)(!1),[F,B]=(0,o.useState)(!1),[H,R]=(0,o.useState)(r.currentScreen),[C,O]=(0,o.useState)(r.playerLives);(0,o.useEffect)(()=>{},[F]);let[j,U]=(0,o.useState)(r.playerAmmo),[z,P]=(0,o.useState)(r.score),[N,W]=(0,o.useState)(!1),[_,Y]=(0,o.useState)(!1),[q,X]=(0,o.useState)(!0),V=(0,o.useRef)({});V.current={gameActive:F,backgroundImage:w,backgroundOpacity:b,lifeUpSprite:f};let J=(0,o.useCallback)(()=>{let t=e.current;if(!t)return;let i=t.getContext("2d");if(i.clearRect(0,0,t.width,t.height),V.current.backgroundImage){let e,s,o;i.save(),i.globalAlpha=V.current.backgroundOpacity;let n=V.current.backgroundImage;n.width,n.height,t.width,t.height,s=t.height,e=n.width*(t.height/n.height),o=(t.width-e)/2,i.drawImage(n,o,0,e,s),i.restore()}if(O(r.playerLives),U(r.playerAmmo),P(r.score),D(r.gameOver),W(r.showReloadOk),Y(0===r.playerAmmo),X(r.showDoubleTapToShoot),R(r.currentScreen),V.current.gameActive&&!r.gameOver)try{let s=0,o=0;r.isPlayerHit?(s=(Math.random()-.5)*10,o=(Math.random()-.5)*10):r.isReloadShaking&&(o=(Math.random()-.5)*5),i.save(),i.translate(s,o),r.processHitCircles(),r.processBadGuyShotEffects(),r.badGuys.forEach(e=>{let t=e.update(performance.now());t&&t.shot&&!r.gameOver&&r.createBadGuyShotEffect(t.x,t.y)}),r.goodGuys.forEach(t=>{if(t.update(performance.now()),!t.isAlive&&t.hasCrossedScreen&&0===r.lifeUps.length){let t=e.current;if(t){let e=Math.random()*(t.width-64),i=Math.random()*(t.height-64);r.addLifeUp(new m(e,i,64,64))}}}),r.unknownGuys.forEach(i=>{let s=i.update(performance.now());if(s&&s.transform){if(.5>Math.random()){let e=S[Math.floor(Math.random()*S.length)],i=new c(s.x,s.y,s.width,s.height,t.width,s.direction,e);i.speed*=1.5,i.reloadTime/=2,i.nextShotTime=Date.now()+i.reloadTime,i.timeToFlash=i.nextShotTime-i.tellDuration,r.addBadGuy(i)}else{let e=x[Math.floor(Math.random()*x.length)],i=new d(s.x,s.y,80,80,t.width,s.direction,e);i.canvasWidth=t.width,r.addGoodGuy(i)}i.isAlive=!1}if(!i.isAlive&&i.hasCrossedScreen&&i.transformed&&0===r.lifeUps.length){let t=e.current;if(t){let e=Math.random()*(t.width-64),i=Math.random()*(t.height-64);r.addLifeUp(new m(e,i,64,64))}}}),r.lifeUps.forEach(e=>e.update(performance.now())),r.badGuys=r.badGuys.filter(e=>e.isAlive),r.goodGuys=r.goodGuys.filter(e=>e.isAlive),r.unknownGuys=r.unknownGuys.filter(e=>e.isAlive),r.lifeUps=r.lifeUps.filter(e=>e.isAlive),r.badGuys.forEach(e=>{let t=S[Math.floor(Math.random()*S.length)],s=80,o=80;if(e.image||(e.image=new Image,e.image.src=t,e.image.onerror=e=>console.error("Failed to load BadGuy image ".concat(t,":"),e)),e.image&&e.image.complete){let t=e.image.width/e.image.height;t>1?o=s/t:t<1&&(s=o*t),i.drawImage(e.image,e.x,e.y,s,o)}else i.fillStyle=e.flashing&&e.flashCount%2==0?"orange":"red",i.fillRect(e.x,e.y,e.width,e.height),o=e.height;if(e.lowerBodyImage&&e.lowerBodyImage.complete){let t=performance.now();t-e.lastFrameTime>e.frameRate&&(e.currentFrameIndex=(e.currentFrameIndex+1)%e.animationFrames.length,e.lastFrameTime=t);let s=e.animationFrames[e.currentFrameIndex];i.drawImage(e.lowerBodyImage,s.x,s.y,e.frameWidth,e.frameHeight,e.x-5,e.y+o-5,80,80)}}),r.goodGuys.forEach(e=>{if(e.image&&e.image.complete){let t=e.image.width/e.image.height,s=80,o=80;t>1?o=s/t:t<1&&(s=o*t),i.drawImage(e.image,e.x,e.y,s,o)}else i.fillStyle="blue",i.fillRect(e.x,e.y,e.width,e.height);if(e.lowerBodyImage&&e.lowerBodyImage.complete){let t=performance.now();t-e.lastFrameTime>e.frameRate&&(e.currentFrameIndex=(e.currentFrameIndex+1)%e.animationFrames.length,e.lastFrameTime=t);let s=e.animationFrames[e.currentFrameIndex];i.drawImage(e.lowerBodyImage,s.x,s.y,e.frameWidth,e.frameHeight,e.x,e.y+e.height-5,80,80)}}),r.unknownGuys.forEach(e=>{if(i.beginPath(),i.arc(e.x+e.width/2,e.y+e.height/2,40,0,2*Math.PI),i.fillStyle="gray",i.fill(),e.lowerBodyImage&&e.lowerBodyImage.complete){let t=performance.now();t-e.lastFrameTime>e.frameRate&&(e.currentFrameIndex=(e.currentFrameIndex+1)%e.animationFrames.length,e.lastFrameTime=t);let s=e.animationFrames[e.currentFrameIndex];i.drawImage(e.lowerBodyImage,s.x,s.y,e.frameWidth,e.frameHeight,e.x,e.y+80,80,80)}}),r.lifeUps.forEach(e=>{V.current.lifeUpSprite?i.drawImage(V.current.lifeUpSprite,e.x,e.y,e.width,e.height):(i.fillStyle="purple",i.fillRect(e.x,e.y,e.width,e.height))}),r.badGuyShotEffects.forEach(e=>{let s=(performance.now()-e.creationTime)/e.duration,o=Math.max(t.width,t.height);i.beginPath(),i.arc(e.x,e.y,Math.max(0,o*s),0,2*Math.PI),i.fillStyle="rgba(255, 0, 0, ".concat(Math.max(0,1-s),")"),i.fill()}),r.hitCircles.forEach(e=>{i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI),i.fillStyle="rgba(255, 255, 0, 0.5)",i.fill(),i.strokeStyle="yellow",i.lineWidth=2,i.stroke()}),r.isPlayerHit&&!r.isHitByBadGuy&&(i.fillStyle="rgba(255, 0, 0, 0.3)",i.fillRect(0,0,t.width,t.height)),i.restore()}catch(e){console.error("Error in game loop:",e),r.gameOver=!0}else r.gameOver&&(l.current&&(clearInterval(l.current),l.current=null),r.badGuys=[],r.goodGuys=[],r.unknownGuys=[],r.lifeUps=[],r.hitCircles=[],r.badGuyShotEffects=[]);n.current=requestAnimationFrame(J)},[]),K=(0,o.useCallback)(()=>{let t=e.current;if(!t)return;let i=Math.random(),s=.5>Math.random(),o=Math.random()*(t.height-50),n=s?-50:t.width,a=s?1:-1,h=x[Math.floor(Math.random()*x.length)];if(i<.75){let e=S[Math.floor(Math.random()*S.length)];r.addBadGuy(new c(n,o,50,50,t.width,a,e))}else if(i<.85){let e=new d(n,o,80,80,t.width,a,h);r.addGoodGuy(e)}else{let e=new u(n,o,50,50,t.width,a);r.addUnknownGuy(e)}},[]),Z=(0,o.useCallback)(()=>{r.setScreen("INTRO"),R("INTRO"),B(!1)},[]),Q=(0,o.useCallback)(()=>{r.reset(),r.setScreen("PLAYING"),R("PLAYING"),r.gameStarted=!0,r.showDoubleTapToShoot=!0,k(0),D(!1),B(!0),n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(J),p.current&&clearTimeout(p.current)},[J,K]),$=(0,o.useCallback)(()=>{r.setScreen("TITLE"),R("TITLE"),r.gameStarted=!1,r.gameOver=!1,D(!1),B(!1),l.current&&clearInterval(l.current),l.current=null,g.current&&clearInterval(g.current),g.current=null,n.current&&cancelAnimationFrame(n.current),p.current&&clearTimeout(p.current),A.current&&clearInterval(A.current),A.current=null,M.current&&clearTimeout(M.current),M.current=null},[]);return(0,o.useEffect)(()=>{let s=e.current;if(!s)return;let o=new Image;o.src="/heart/heartplus.png",o.onload=()=>{y(o)},o.onerror=e=>{console.error("Failed to load heartplus.png:",e)};let h=new Image;h.src=E[r.getBackgroundIndexForLevel()],h.onload=()=>{T(h),I(1)},h.onerror=e=>{console.error("Failed to load initial background image ".concat(E[r.getBackgroundIndexForLevel()],":"),e)};let c=s.parentElement,d=()=>{c.style.width=window.innerWidth>600?"400px":"90%",c.style.height="".concat(.8*window.innerHeight,"px"),c.style.position="relative",s.width=c.offsetWidth,s.height=c.offsetHeight};return d(),window.addEventListener("resize",d),t.current=new a(s),t.current.onShoot=(e,t)=>{i.current.shoot()&&(r.shootBullet(),r.createHitCircle(e,t))},t.current.onReload=()=>{r.playerAmmo<6&&!i.current.reloading&&(i.current.reloading=!0,p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{i.current.reload(),r.reloadAmmo(),p.current=null},1e3))},n.current=requestAnimationFrame(J),F?(l.current&&clearInterval(l.current),l.current=setInterval(K,2e3),g.current&&clearInterval(g.current),g.current=setInterval(()=>{let t=e.current;if(t&&0===r.lifeUps.length){let e=Math.random()*(t.width-64),i=Math.random()*(t.height-64);r.addLifeUp(new m(e,i,64,64))}},15e3)):(l.current&&clearInterval(l.current),g.current&&clearInterval(g.current),A.current&&clearInterval(A.current)),()=>{window.removeEventListener("resize",d),n.current&&cancelAnimationFrame(n.current),l.current&&clearInterval(l.current),g.current&&clearInterval(g.current),p.current&&clearTimeout(p.current),A.current&&clearInterval(A.current),M.current&&clearTimeout(M.current);let e=t.current;e&&(e.canvas.removeEventListener("mousedown",e.boundHandleMouseDown),e.canvas.removeEventListener("mouseup",e.boundHandleMouseUp),e.canvas.removeEventListener("mousemove",e.boundHandleMouseMove),e.canvas.removeEventListener("touchstart",e.boundHandleTouchStart),e.canvas.removeEventListener("touchend",e.boundHandleTouchEnd),e.canvas.removeEventListener("touchmove",e.boundHandleTouchMove))}},[F,J,K]),(0,o.useEffect)(()=>{let e=new Image;e.src=E[r.getBackgroundIndexForLevel()],e.onload=()=>{T(e)},e.onerror=e=>{console.error("Failed to load background image ".concat(E[r.getBackgroundIndexForLevel()],":"),e)}},[r.currentLevel]),(0,o.useEffect)(()=>{L&&B(!1)},[L]),(0,s.jsxs)("div",{style:{border:"1px solid black",margin:"auto",position:"relative",width:"100%",height:"100%"},children:[(0,s.jsx)("canvas",{ref:e,style:{display:"block",width:"100%",height:"100%"}}),(0,s.jsx)(v,{lives:C,ammo:j,score:z,gameOver:L,showReloadOk:N,isFlashingReload:_,showDoubleTapToShoot:q,onRestart:Q,onReturnToTitle:$,currentScreen:H,onStartIntro:Z,onStartGame:Q,currentLevel:r.currentLevel})]})},b=i(2969),I=i.n(b);function G(){return(0,s.jsx)("main",{className:I().main,children:(0,s.jsx)(T,{})})}},2969:function(e){e.exports={main:"home_main__gAgsa",hr:"home_hr__6Ge2D"}}},function(e){e.O(0,[530,648,971,23,744],function(){return e(e.s=3946)}),_N_E=e.O()}]);